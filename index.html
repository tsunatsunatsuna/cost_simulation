<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ã¾ã„ã®å®Ÿè³ªã‚³ã‚¹ãƒˆæ¯”è¼ƒ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary-color: #2c3e50; }
        body { background-color: #f4f7f6; font-size: 0.9rem; }
        .card-header { font-weight: bold; }
        .info-icon { cursor: pointer; color: #0d6efd; margin-left: 5px; }
        .result-box { background: #fff; border-radius: 10px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .nav-pills .nav-link.active { background-color: var(--primary-color); }
    </style>
</head>
<body>

<div class="container-fluid py-4">
    <h2 class="text-center mb-4">ğŸ  ä¸å‹•ç”£æ¯”è¼ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>

    <div class="row">
        <div class="col-lg-5">
            <div class="card mb-3 shadow-sm">
                <div class="card-header bg-dark text-white">å…±é€šè¨­å®š</div>
                <div class="card-body row">
                    <div class="col-6 mb-2">
                        <label>æ¯”è¼ƒå¹´æ•°</label>
                        <select id="sim_years" class="form-select">
                            <option value="10">10å¹´</option>
                            <option value="20">20å¹´</option>
                            <option value="35" selected>35å¹´</option>
                        </select>
                    </div>
                    <div class="col-6 mb-2">
                        <label>ã‚¤ãƒ³ãƒ•ãƒ¬ç‡ (%)</label>
                        <input type="number" id="inflation" class="form-control" value="0" step="0.1">
                    </div>
                    <div class="col-6 mb-2">
                        <label>ä¸–å¸¯å¹´å (ä¸‡å††)</label>
                        <input type="number" id="income" class="form-control" value="800">
                    </div>
                    <div class="col-6 mb-2">
                        <label>å£²å´ã™ã‚‹ã‹</label>
                        <select id="will_sell" class="form-select">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                </div>
            </div>

            <ul class="nav nav-pills mb-3 justify-content-center" id="pills-tab" role="tablist">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="pill" data-bs-target="#tab-rent">è³ƒè²¸</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-mansion">ãƒãƒ³ã‚·ãƒ§ãƒ³</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="pill" data-bs-target="#tab-house">æˆ¸å»º</button></li>
            </ul>

            <div class="tab-content border p-3 bg-white rounded shadow-sm">
                <div class="tab-pane fade show active" id="tab-rent">
                    <label>æƒ³å®šå®¶è³ƒ (å††)</label>
                    <input type="number" id="rent_price" class="form-control mb-2" value="160000">
                    <label>æ›´æ–°æ–™ (2å¹´æ¯/å††)</label>
                    <input type="number" id="rent_update" class="form-control mb-2" value="160000">
                    <label>å®¶è³ƒä¸Šæ˜‡ç‡ (%)</label>
                    <input type="number" id="rent_up_rate" class="form-control mb-2" value="0">
                    <p class="text-muted small">â€»åˆæœŸè²»ç”¨ã¯å®¶è³ƒã®5å€(æ¨å¥¨)ã§è‡ªå‹•è¨ˆç®—ã•ã‚Œã¾ã™</p>
                </div>

                <div class="tab-pane fade" id="tab-mansion">
                    <div class="mb-2">
                        <input type="radio" name="m_type" value="new" checked onclick="toggleMansion(false)"> æ–°ç¯‰ 
                        <input type="radio" name="m_type" value="old" onclick="toggleMansion(true)"> ä¸­å¤
                    </div>
                    <label>ç‰©ä»¶ä¾¡æ ¼ (å††)</label>
                    <input type="number" id="m_price" class="form-control mb-2" value="50000000">
                    <div id="m_old_options" style="display:none;">
                        <label>ç¯‰å¹´æ•°</label><input type="number" id="m_age" class="form-control mb-2" value="10">
                        <label>ä¿®ç¹•ç©ç«‹ä¸Šæ˜‡ç‡ (%)</label><input type="number" id="m_up_rate" class="form-control mb-2" value="3.0">
                    </div>
                    <label>ç®¡ç†ãƒ»ä¿®ç¹•è²»/æœˆ</label><input type="number" id="m_maint" class="form-control mb-2" value="30000">
                    <label>é‡‘åˆ©ã‚¿ã‚¤ãƒ—</label>
                    <select id="m_loan_type" class="form-select mb-2" onchange="toggleRate('m')">
                        <option value="flex">å¤‰å‹•</option>
                        <option value="fixed">å›ºå®š (2%)</option>
                    </select>
                    <input type="number" id="m_rate" class="form-control mb-2" value="0.5" step="0.1">
                </div>

                <div class="tab-pane fade" id="tab-house">
                    <div class="mb-2">
                        <input type="radio" name="h_type" value="new" checked onclick="toggleHouse(false)"> æ–°ç¯‰ 
                        <input type="radio" name="h_type" value="old" onclick="toggleHouse(true)"> ä¸­å¤
                    </div>
                    <label>ç‰©ä»¶ä¾¡æ ¼ (å††)</label>
                    <input type="number" id="h_price" class="form-control mb-2" value="50000000">
                    <div id="h_old_options" style="display:none;">
                        <label>ç¯‰å¹´æ•°</label><input type="number" id="h_age" class="form-control mb-2" value="15">
                        <label>å»ºç‰©æ¸›ä¾¡ç‡ (%)</label><input type="number" id="h_depre" class="form-control mb-2" value="3.0">
                    </div>
                    <label>å¤§è¦æ¨¡ä¿®ç¹•è²» (å††/å›)</label><input type="number" id="h_maint" class="form-control mb-2" value="2000000">
                    <label>ãƒ­ãƒ¼ãƒ³æœŸé–“</label>
                    <select id="h_loan_term" class="form-select mb-2">
                        <option value="15">15å¹´</option>
                        <option value="25">25å¹´</option>
                        <option value="35" selected>35å¹´</option>
                    </select>
                </div>
            </div>
            
            <button class="btn btn-primary w-100 mt-3 py-3 fw-bold" onclick="runSimulation()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¨ˆç®—å®Ÿè¡Œ</button>
        </div>

        <div class="col-lg-7">
            <div class="result-box">
                <h4>ğŸ“Š æ¯”è¼ƒçµæœ</h4>
                <canvas id="mainChart" height="150"></canvas>
                <div class="table-responsive mt-3">
                    <table class="table table-bordered text-center">
                        <thead class="table-light">
                            <tr>
                                <th>é …ç›®</th>
                                <th>è³ƒè²¸</th>
                                <th>ãƒãƒ³ã‚·ãƒ§ãƒ³</th>
                                <th>æˆ¸å»º</th>
                            </tr>
                        </thead>
                        <tbody id="result-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// --- UIåˆ¶å¾¡ ---
function toggleMansion(isOld) { document.getElementById('m_old_options').style.display = isOld ? 'block' : 'none'; }
function toggleHouse(isOld) { document.getElementById('h_old_options').style.display = isOld ? 'block' : 'none'; }
function toggleRate(prefix) {
    const type = document.getElementById(prefix + '_loan_type').value;
    const rateInput = document.getElementById(prefix + '_rate');
    if(type === 'fixed') { rateInput.value = 2.0; rateInput.disabled = true; }
    else { rateInput.disabled = false; }
}

// --- è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ ---
function runSimulation() {
    const years = parseInt(document.getElementById('sim_years').value);
    const inflation = parseFloat(document.getElementById('inflation').value) / 100;
    const willSell = document.getElementById('will_sell').value === 'yes';

    // 1. è³ƒè²¸è¨ˆç®—
    const rentBase = parseFloat(document.getElementById('rent_price').value);
    const rentUpdate = parseFloat(document.getElementById('rent_update').value);
    const initRent = rentBase * 5; // åˆæœŸè²»ç”¨
    let rentTotal = initRent;
    for(let i=1; i<=years; i++) {
        rentTotal += (rentBase * 12) * Math.pow(1 + inflation, i);
        if(i % 2 === 0) rentTotal += rentUpdate;
    }

    // 2. ãƒãƒ³ã‚·ãƒ§ãƒ³è¨ˆç®— (ç°¡æ˜“)
    const mPrice = parseFloat(document.getElementById('m_price').value);
    const mRate = parseFloat(document.getElementById('m_rate').value) / 100 / 12;
    const mPayment = (mPrice * mRate * Math.pow(1+mRate, 35*12)) / (Math.pow(1+mRate, 35*12)-1);
    let mTotal = mPrice * 0.05; // è«¸è²»ç”¨
    mTotal += (mPayment * 12 * Math.min(years, 35));
    mTotal += (parseFloat(document.getElementById('m_maint').value) * 12 * years);
    
    // å£²å´æƒ³å®š (å¹´2%ä¸‹è½ã¨ä»®å®š)
    const mSale = willSell ? mPrice * Math.pow(0.98, years) : 0;
    const mRealCost = mTotal - mSale;

    // 3. æˆ¸å»ºè¨ˆç®— (ç°¡æ˜“)
    const hPrice = parseFloat(document.getElementById('h_price').value);
    let hTotal = hPrice * 0.05 + (mPayment * 12 * Math.min(years, 35)); // ãƒ­ãƒ¼ãƒ³ã¯ãƒãƒ³ã‚·ãƒ§ãƒ³ã¨åŒé¡è¨ˆç®—
    hTotal += parseFloat(document.getElementById('h_maint').value) * Math.floor(years/10); // 10å¹´æ¯ã«ä¿®ç¹•

    const hSale = willSell ? hPrice * 0.5 : 0; // åœŸåœ°å€¤
    const hRealCost = hTotal - hSale;

    // ãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
    const tbody = document.getElementById('result-table-body');
    tbody.innerHTML = `
        <tr>
            <td>ç·æ”¯æ‰•é¡</td>
            <td>Â¥${Math.round(rentTotal).toLocaleString()}</td>
            <td>Â¥${Math.round(mTotal).toLocaleString()}</td>
            <td>Â¥${Math.round(hTotal).toLocaleString()}</td>
        </tr>
        <tr class="table-warning fw-bold">
            <td>å®Ÿè³ªã‚³ã‚¹ãƒˆ</td>
            <td>Â¥${Math.round(rentTotal).toLocaleString()}</td>
            <td>Â¥${Math.round(mRealCost).toLocaleString()}</td>
            <td>Â¥${Math.round(hRealCost).toLocaleString()}</td>
        </tr>
        <tr>
            <td>æœˆé¡å®Ÿè³ªè² æ‹…</td>
            <td>Â¥${Math.round(rentTotal/years/12).toLocaleString()}</td>
            <td>Â¥${Math.round(mRealCost/years/12).toLocaleString()}</td>
            <td>Â¥${Math.round(hRealCost/years/12).toLocaleString()}</td>
        </tr>
    `;

    updateChart(rentTotal, mRealCost, hRealCost);
}

let chart;
function updateChart(r, m, h) {
    const ctx = document.getElementById('mainChart').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['è³ƒè²¸', 'ãƒãƒ³ã‚·ãƒ§ãƒ³', 'æˆ¸å»º'],
            datasets: [{
                label: 'å®Ÿè³ªã‚³ã‚¹ãƒˆ (ç·æ”¯æ‰• - å£²å´ç›Š)',
                data: [r, m, h],
                backgroundColor: ['#20c997', '#0d6efd', '#fd7e14']
            }]
        }
    });
}
window.onload = runSimulation;
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
