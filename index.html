<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ã¾ã„ã®è²»ç”¨æ¯”è¼ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .input-card { margin-bottom: 20px; }
        .result-chart { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; }
    </style>
</head>
<body>

<div class="container py-5">
    <h1 class="text-center mb-4">ğŸ  ä½ã¾ã„ã®è²»ç”¨æ¯”è¼ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
    <p class="text-muted text-center">50å¹´é–“ã®ãƒˆãƒ¼ã‚¿ãƒ«ã‚³ã‚¹ãƒˆã‚’æ¦‚ç®—ã—ã¾ã™</p>

    <div class="row">
        <div class="col-md-4">
            <div class="card input-card shadow-sm">
                <div class="card-header bg-success text-white">è³ƒè²¸ã®æ¡ä»¶</div>
                <div class="card-body">
                    <label>å®¶è³ƒ/æœˆ (å††)</label>
                    <input type="number" id="rent_monthly" class="form-control mb-2" value="160000">
                    <label>æ›´æ–°æ–™ (2å¹´æ¯/å††)</label>
                    <input type="number" id="rent_update" class="form-control mb-2" value="160000">
                </div>
            </div>

            <div class="card input-card shadow-sm">
                <div class="card-header bg-primary text-white">è³¼å…¥ã®æ¡ä»¶ (ãƒãƒ³ã‚·ãƒ§ãƒ³)</div>
                <div class="card-body">
                    <label>ç‰©ä»¶ä¾¡æ ¼ (å††)</label>
                    <input type="number" id="buy_price" class="form-control mb-2" value="50000000">
                    <label>ãƒ­ãƒ¼ãƒ³é‡‘åˆ© (%)</label>
                    <input type="number" id="loan_interest" class="form-control mb-2" step="0.1" value="1.0">
                    <label>ç®¡ç†ãƒ»ä¿®ç¹•è²»/æœˆ (å††)</label>
                    <input type="number" id="maint_monthly" class="form-control mb-2" value="28000">
                </div>
            </div>
            
            <button class="btn btn-dark w-100 py-2" onclick="calculate()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
        </div>

        <div class="col-md-8">
            <div class="result-chart shadow-sm">
                <canvas id="costChart"></canvas>
            </div>
            <div id="summary" class="mt-4 p-3 bg-white rounded shadow-sm">
                </div>
        </div>
    </div>
</div>

<script>
let myChart;

function calculate() {
    const years = 50;
    const rentMonthly = parseFloat(document.getElementById('rent_monthly').value);
    const rentUpdate = parseFloat(document.getElementById('rent_update').value);
    const buyPrice = parseFloat(document.getElementById('buy_price').value);
    const maintMonthly = parseFloat(document.getElementById('maint_monthly').value);
    const interest = parseFloat(document.getElementById('loan_interest').value) / 100 / 12;
    
    // ãƒ­ãƒ¼ãƒ³è¨ˆç®— (å…ƒåˆ©å‡ç­‰)
    const loanTerm = 35 * 12;
    const monthlyPayment = (buyPrice * interest * Math.pow(1 + interest, loanTerm)) / (Math.pow(1 + interest, loanTerm) - 1);

    let rentTotal = [];
    let buyTotal = [];
    let labels = [];

    let currentRentSum = 0;
    let currentBuySum = 0; // åˆæœŸè²»ç”¨ãªã©ã¯ä»Šå›ç°¡æ˜“åŒ–

    for (let y = 1; y <= years; y++) {
        labels.push(y + "å¹´ç›®");
        
        // è³ƒè²¸è¨ˆç®—
        currentRentSum += (rentMonthly * 12);
        if (y % 2 === 0) currentRentSum += rentUpdate;
        rentTotal.push(currentRentSum);

        // è³¼å…¥è¨ˆç®—
        if (y <= 35) {
            currentBuySum += (monthlyPayment * 12);
        }
        currentBuySum += (maintMonthly * 12);
        buyTotal.push(currentBuySum);
    }

    updateChart(labels, rentTotal, buyTotal);
    document.getElementById('summary').innerHTML = `
        <h5>ã€50å¹´å¾Œã®çµæœã€‘</h5>
        <p>è³ƒè²¸ç·é¡: <strong>Â¥${rentTotal[49].toLocaleString()}</strong></p>
        <p>è³¼å…¥ç·é¡: <strong>Â¥${buyTotal[49].toLocaleString()}</strong></p>
    `;
}

function updateChart(labels, rentData, buyData) {
    const ctx = document.getElementById('costChart').getContext('2d');
    if (myChart) myChart.destroy();
    
    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                { label: 'è³ƒè²¸', data: rentData, borderColor: '#198754', fill: false },
                { label: 'è³¼å…¥', data: buyData, borderColor: '#0d6efd', fill: false }
            ]
        },
        options: { responsive: true, plugins: { legend: { position: 'top' } } }
    });
}

// åˆå›å®Ÿè¡Œ
calculate();
</script>
</body>
</html>
