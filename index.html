<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒ 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main-bg: #f0f2f5; }
        body { background-color: var(--main-bg); font-family: sans-serif; }
        .card { border-radius: 12px; border: none; margin-bottom: 20px; }
        .info-mark { cursor: help; color: #0d6efd; font-size: 0.9rem; margin-left: 4px; }
        .tab-content { background: #fff; padding: 25px; border-radius: 0 0 12px 12px; border: 1px solid #dee2e6; border-top: none; }
        .result-table th { background: #343a40; color: white; text-align: center; }
        .slider-label { display: flex; justify-content: space-between; align-items: center; }
        .val-display { font-weight: bold; color: #0d6efd; font-size: 1.2rem; }
    </style>
</head>
<body>

<div class="container py-4">
    <h2 class="text-center mb-4">ğŸ  ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h2>

    <div class="row">
        <div class="col-xl-4">
            <div class="card shadow-sm p-3">
                <h5 class="fw-bold border-bottom pb-2">å…±é€šãƒ»ãƒ­ãƒ¼ãƒ³è¨­å®š</h5>
                <div class="row g-3 mt-1">
                    <div class="col-6">
                        <label class="small">æ¯”è¼ƒå¹´æ•°</label>
                        <select id="sim_years" class="form-select" onchange="calculateAll()">
                            <option value="10">10å¹´</option><option value="20">20å¹´</option><option value="35">35å¹´</option><option value="50" selected>50å¹´</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small">ã‚¤ãƒ³ãƒ•ãƒ¬ç‡ (%)</label>
                        <input type="number" id="inflation" class="form-control" value="0.5" step="0.1" onchange="calculateAll()">
                    </div>
                    <div class="col-6">
                        <label class="small">ä¸–å¸¯å¹´å (ä¸‡å††)</label>
                        <input type="number" id="income" class="form-control" value="800" onchange="calculateAll()">
                    </div>
                    <div class="col-6">
                        <label class="small">ãƒšã‚¢ãƒ­ãƒ¼ãƒ³
                            <span class="info-mark" title="2äººã§ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤ã‚’å—ã‘ã‚‹å ´åˆã€å„ã€…ã®æŒã¡åˆ†ã«å¿œã˜ã¦æ§é™¤æ ã‚’åˆç®—ã§ãã¾ã™ã€‚ã“ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã§ã¯æ§é™¤æ®‹é«˜ä¸Šé™ã‚’2å€ã¨ã—ã¦è¨ˆç®—ã—ã¾ã™ã€‚">â“˜</span>
                        </label>
                        <select id="is_pair" class="form-select" onchange="calculateAll()">
                            <option value="1">ãªã—</option><option value="2">ã‚ã‚Š (æ 2å€)</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small">é‡‘åˆ©ã‚¿ã‚¤ãƒ—</label>
                        <select id="loan_type" class="form-select" onchange="updateRate(); calculateAll();">
                            <option value="flex">å¤‰å‹•</option><option value="fixed">å›ºå®š (2%)</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small">é‡‘åˆ© (%)</label>
                        <input type="number" id="loan_rate" class="form-control" value="0.5" step="0.1" onchange="calculateAll()">
                    </div>
                    <div class="col-12">
                        <label class="small">ãƒ­ãƒ¼ãƒ³æœŸé–“ (å¹´)</label>
                        <select id="loan_term" class="form-select" onchange="calculateAll()">
                            <option value="15">15å¹´</option><option value="25">25å¹´</option><option value="35" selected>35å¹´</option>
                        </select>
                    </div>
                </div>
            </div>

            <ul class="nav nav-tabs mt-3" id="mainTabs">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#t-rent">è³ƒè²¸</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t-nm">æ–°ç¯‰ãƒ</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t-om">ä¸­å¤ãƒ</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t-nh">æ–°ç¯‰æˆ¸</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#t-oh">ä¸­å¤æˆ¸</button></li>
            </ul>

            <div class="tab-content shadow-sm mb-3">
                <div class="tab-pane fade show active" id="t-rent">
                    <div class="slider-label">
                        <label class="small">æœˆé¡å®¶è³ƒ (ä¸‡å††)</label>
                        <span id="rent_val" class="val-display">16</span>
                    </div>
                    <input type="range" id="r_price" class="form-range" min="0" max="30" step="1" value="16" oninput="updateRentLabel(); calculateAll();">
                    
                    <div class="mt-3">
                        <p class="mb-1 small">æ›´æ–°æ–™: <span class="fw-bold">å®¶è³ƒ1ãƒ¶æœˆåˆ†</span> <span class="info-mark" title="2å¹´ã”ã¨ã«å®¶è³ƒã®1ãƒ¶æœˆåˆ†ãŒç™ºç”Ÿã™ã‚‹ã¨ä»®å®šã—ã¦ã„ã¾ã™ã€‚">â“˜</span></p>
                        <p class="mb-1 small">åˆæœŸè²»ç”¨: <span id="r_init_disp" class="fw-bold">80</span> ä¸‡å†† <span class="info-mark" title="æ•·é‡‘ãƒ»ç¤¼é‡‘ãƒ»ä»²ä»‹æ‰‹æ•°æ–™ç­‰ã‚’å«ã‚ã€å®¶è³ƒã®5å€ã§è‡ªå‹•è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚">â“˜</span></p>
                    </div>
                </div>

                <div class="tab-pane fade" id="t-nm">
                    <label class="small">ç‰©ä»¶ä¾¡æ ¼ (ä¸‡å††)</label><input type="number" id="nm_price" class="form-control mb-2" value="6000" onchange="calculateAll()">
                    <label class="small">ç®¡ç†ãƒ»ä¿®ç¹•è²»/æœˆ (ä¸‡å††)</label><input type="number" id="nm_maint" class="form-control mb-2" value="3.5" onchange="calculateAll()">
                    <label class="small">æ§é™¤åŒºåˆ† <span class="info-mark" data-bs-toggle="modal" data-bs-target="#taxModal">â“˜</span></label>
                    <select id="nm_tax" class="form-select mb-2" onchange="calculateAll()"><option value="4500">é•·æœŸå„ªè‰¯ (4500ä¸‡)</option><option value="3500" selected>ZEHæ°´æº– (3500ä¸‡)</option><option value="3000">çœã‚¨ãƒ (3000ä¸‡)</option></select>
                </div>
                
                <div class="tab-pane fade" id="t-om">
                    <label class="small">ç‰©ä»¶ä¾¡æ ¼ (ä¸‡å††)</label><input type="number" id="om_price" class="form-control mb-2" value="4500" onchange="calculateAll()">
                    <label class="small">ãƒªãƒ•ã‚©ãƒ¼ãƒ è²»ç”¨ (ä¸‡å††)</label><input type="number" id="om_ref" class="form-control mb-2" value="2000" onchange="calculateAll()">
                    <label class="small">æ§é™¤åŒºåˆ† <span class="info-mark" data-bs-toggle="modal" data-bs-target="#taxModal">â“˜</span></label>
                    <select id="om_tax" class="form-select mb-2" onchange="calculateAll()"><option value="3000">çœã‚¨ãƒä¸­å¤ (3000ä¸‡)</option><option value="2000" selected>ä¸€èˆ¬ä¸­å¤ (2000ä¸‡)</option></select>
                </div>

                <div class="tab-pane fade" id="t-nh">
                    <label class="small">ä¾¡æ ¼ (ä¸‡å††)</label><input type="number" id="nh_price" class="form-control mb-2" value="5500" onchange="calculateAll()">
                    <label class="small">å¤§è¦æ¨¡ä¿®ç¹• (ä¸‡å††/10å¹´)</label><input type="number" id="nh_maint" class="form-control mb-2" value="200" onchange="calculateAll()">
                </div>

                <div class="tab-pane fade" id="t-oh">
                    <label class="small">ä¾¡æ ¼ (ä¸‡å††)</label><input type="number" id="oh_price" class="form-control mb-2" value="4000" onchange="calculateAll()">
                    <label class="small">å¤§è¦æ¨¡ä¿®ç¹• (ä¸‡å††/10å¹´)</label><input type="number" id="oh_maint" class="form-control mb-2" value="200" onchange="calculateAll()">
                </div>
            </div>
        </div>

        <div class="col-xl-8">
            <div class="card shadow-sm p-3">
                <canvas id="mainLineChart" height="200"></canvas>
            </div>
            <div class="table-responsive shadow-sm">
                <table class="table table-bordered table-hover text-center bg-white mb-0">
                    <thead class="table-dark">
                        <tr><th>50å¹´ç´¯è¨ˆè²»ç”¨</th><th>è³ƒè²¸</th><th>æ–°ç¯‰ãƒ</th><th>ä¸­å¤ãƒ</th><th>æ–°ç¯‰æˆ¸</th><th>ä¸­å¤æˆ¸</th></tr>
                    </thead>
                    <tbody id="resTbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="taxModal" tabindex="-1">
    <div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h5>ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤ 2026å¹´å…¥å±…</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body small">
        <p>æ–°ç¯‰ã¯13å¹´é–“ã€ä¸­å¤ã¯10å¹´é–“ã®æ§é™¤ãŒå—ã‘ã‚‰ã‚Œã¾ã™ã€‚æ§é™¤ç‡ã¯0.7%ã§ã™ã€‚</p>
        <table class="table table-sm border"><tr><th>åŒºåˆ†</th><th>æ®‹é«˜ä¸Šé™</th></tr><tr><td>é•·æœŸå„ªè‰¯ãƒ»ä½ç‚­ç´ </td><td>4,500ä¸‡å††</td></tr><tr><td>ZEHæ°´æº–</td><td>3,500ä¸‡å††</td></tr><tr><td>çœã‚¨ãƒåŸºæº–</td><td>3,000ä¸‡å††</td></tr><tr><td>ä¸­å¤ä¸€èˆ¬</td><td>2,000ä¸‡å††</td></tr></table>
    </div></div></div>
</div>

<script>
let myChart;

function updateRate() {
    const type = document.getElementById('loan_type').value;
    const rateInput = document.getElementById('loan_rate');
    if(type === 'fixed') { rateInput.value = 2.0; rateInput.disabled = true; }
    else { rateInput.disabled = false; }
}

function updateRentLabel() {
    const val = document.getElementById('r_price').value;
    document.getElementById('rent_val').innerText = val;
    document.getElementById('r_init_disp').innerText = val * 5;
}

function calculateAll() {
    const years = parseInt(document.getElementById('sim_years').value);
    const inflation = parseFloat(document.getElementById('inflation').value) / 100;
    const isPair = parseInt(document.getElementById('is_pair').value);
    const loanRate = parseFloat(document.getElementById('loan_rate').value) / 100 / 12;
    const loanTerm = parseInt(document.getElementById('loan_term').value) * 12;

    const ids = ['r', 'nm', 'om', 'nh', 'oh'];
    let finalRes = {};
    let chartLabels = Array.from({length: years}, (_, i) => (i+1) + "å¹´");
    let chartDatasets = [];

    ids.forEach(id => {
        let cumulativeCosts = [];
        let total = 0;
        let assetValue = 0;

        if(id === 'r') {
            const rent = parseFloat(document.getElementById('r_price').value) * 10000;
            total = rent * 5; // åˆæœŸè²»ç”¨
            for(let y=1; y<=years; y++) {
                let yCost = (rent * 12) * Math.pow(1+inflation, y);
                if(y % 2 === 0) yCost += rent; // æ›´æ–°æ–™
                total += yCost;
                cumulativeCosts.push(total / 10000);
            }
            finalRes.r = { total: total, real: total, history: cumulativeCosts };
        } else {
            const price = parseFloat(document.getElementById(id + '_price').value) * 10000;
            const taxLimit = (parseInt(document.getElementById(id + '_tax')?.value || 2000) * 10000) * isPair;
            const taxYears = id.startsWith('n') ? 13 : 10;
            
            // ãƒ­ãƒ¼ãƒ³å…ƒåˆ©å‡ç­‰
            const mPay = (price * loanRate * Math.pow(1+loanRate, loanTerm)) / (Math.pow(1+loanRate, loanTerm)-1);
            let balance = price;
            total = price * 0.05; // è«¸è²»ç”¨
            if(id === 'om') total += parseFloat(document.getElementById('om_ref').value) * 10000;

            for(let y=1; y<=years; y++) {
                let yOut = 0;
                if(y <= loanTerm/12) {
                    yOut += mPay * 12;
                    if(y <= taxYears) yOut -= (Math.min(balance, taxLimit) * 0.007);
                    balance -= (mPay * 12 - (balance * loanRate * 12));
                }
                yOut += (price * 0.003); // å›ºå®šè³‡ç”£ç¨ (æ¦‚ç®—)
                
                if(id.includes('m')) {
                    yOut += parseFloat(document.getElementById(id + '_maint').value) * 10000 * 12;
                } else if(y % 10 === 0) {
                    yOut += parseFloat(document.getElementById(id + '_maint').value) * 10000;
                }
                total += yOut;
                cumulativeCosts.push(total / 10000);
            }
            // è³‡ç”£ä¾¡å€¤
            assetValue = id.includes('m') ? price * Math.pow(0.97, years) : price * 0.5;
            finalRes[id] = { total: total, real: total - assetValue, history: cumulativeCosts };
        }
    });

    // è¡¨æ›´æ–°
    const rowH = (val) => Math.round(val / 10000).toLocaleString() + "ä¸‡";
    const rowM = (val) => Math.round(val / years / 12).toLocaleString() + "å††";
    document.getElementById('resTbody').innerHTML = `
        <tr><td>ç·æ”¯æ‰•é¡</td><td>${rowH(finalRes.r.total)}</td><td>${rowH(finalRes.nm.total)}</td><td>${rowH(finalRes.om.total)}</td><td>${rowH(finalRes.nh.total)}</td><td>${rowH(finalRes.oh.total)}</td></tr>
        <tr class="table-warning fw-bold"><td>å®Ÿè³ªã‚³ã‚¹ãƒˆ</td><td>${rowH(finalRes.r.real)}</td><td>${rowH(finalRes.nm.real)}</td><td>${rowH(finalRes.om.real)}</td><td>${rowH(finalRes.nh.real)}</td><td>${rowH(finalRes.oh.real)}</td></tr>
        <tr><td>æœˆé¡è² æ‹…</td><td>${rowM(finalRes.r.real)}</td><td>${rowM(finalRes.nm.real)}</td><td>${rowM(finalRes.om.real)}</td><td>${rowM(finalRes.nh.real)}</td><td>${rowM(finalRes.oh.real)}</td></tr>
    `;

    // ã‚°ãƒ©ãƒ•æ›´æ–°
    const ctx = document.getElementById('mainLineChart').getContext('2d');
    if(myChart) myChart.destroy();
    myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: chartLabels,
            datasets: [
                { label: 'è³ƒè²¸', data: finalRes.r.history, borderColor: '#198754', tension: 0.1 },
                { label: 'æ–°ç¯‰ãƒ', data: finalRes.nm.history, borderColor: '#0d6efd', tension: 0.1 },
                { label: 'ä¸­å¤ãƒ', data: finalRes.om.history, borderColor: '#0dcaf0', tension: 0.1 },
                { label: 'æ–°ç¯‰æˆ¸', data: finalRes.nh.history, borderColor: '#fd7e14', tension: 0.1 },
                { label: 'ä¸­å¤æˆ¸', data: finalRes.oh.history, borderColor: '#6f42c1', tension: 0.1 }
            ]
        },
        options: { responsive: true, interaction: { mode: 'index', intersect: false }, plugins: { title: { display: true, text: 'ç´¯è¨ˆæ”¯å‡ºã®æ¨ç§» (ä¸‡å††)' } } }
    });
}

window.onload = () => { updateRentLabel(); calculateAll(); };
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
