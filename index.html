<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main-bg: #f8f9fa; }
        body { background-color: var(--main-bg); font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", sans-serif; }
        .config-card { border-left: 5px solid #0d6efd; margin-bottom: 20px; }
        .info-btn { cursor: pointer; color: #6c757d; font-size: 0.8rem; text-decoration: underline; }
        .tab-content { background: #fff; padding: 20px; border: 1px solid #dee2e6; border-top: none; border-radius: 0 0 8px 8px; }
        .result-highlight { font-size: 1.5rem; font-weight: bold; color: #dc3545; }
    </style>
</head>
<body>

<div class="container-fluid py-4">
    <h2 class="text-center mb-4">ğŸ  ä½ã¾ã„ã®å®Ÿè³ªã‚³ã‚¹ãƒˆæ¯”è¼ƒ (2026å¹´ç‰ˆ)</h2>

    <div class="row">
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow-sm config-card">
                <div class="card-header bg-white fw-bold">1. å…±é€šãƒ»ãƒ­ãƒ¼ãƒ³è¨­å®š</div>
                <div class="card-body row g-2">
                    <div class="col-6">
                        <label class="small">æ¯”è¼ƒå¹´æ•°</label>
                        <select id="sim_years" class="form-select form-select-sm">
                            <option value="10">10å¹´</option><option value="20">20å¹´</option><option value="35" selected>35å¹´</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small">ã‚¤ãƒ³ãƒ•ãƒ¬ç‡ (%)</label>
                        <input type="number" id="inflation" class="form-control form-control-sm" value="0.5">
                    </div>
                    <div class="col-6">
                        <label class="small">ä¸–å¸¯å¹´å (ä¸‡å††)</label>
                        <input type="number" id="income" class="form-control form-control-sm" value="800">
                    </div>
                    <div class="col-6">
                        <label class="small">ãƒšã‚¢ãƒ­ãƒ¼ãƒ³</label>
                        <select id="is_pair" class="form-select form-select-sm">
                            <option value="1">ãªã— (å˜ç‹¬)</option><option value="2">ã‚ã‚Š (2äººåˆ†æ )</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small">é‡‘åˆ©ã‚¿ã‚¤ãƒ—</label>
                        <select id="loan_type" class="form-select form-select-sm" onchange="updateRate()">
                            <option value="flex">å¤‰å‹• (ä»»æ„å…¥åŠ›)</option>
                            <option value="fixed">å›ºå®š (2.0%)</option>
                        </select>
                    </div>
                    <div class="col-6">
                        <label class="small">é‡‘åˆ© (%)</label>
                        <input type="number" id="loan_rate" class="form-control form-control-sm" value="0.5" step="0.1">
                    </div>
                    <div class="col-12">
                        <label class="small">ãƒ­ãƒ¼ãƒ³æœŸé–“</label>
                        <select id="loan_term" class="form-select form-select-sm">
                            <option value="15">15å¹´</option><option value="25">25å¹´</option><option value="35" selected>35å¹´</option>
                        </select>
                    </div>
                </div>
            </div>

            <ul class="nav nav-tabs mt-3" id="calcTabs">
                <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-rent">è³ƒè²¸</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-nm">æ–°ç¯‰ãƒ</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-om">ä¸­å¤ãƒ</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-nh">æ–°ç¯‰æˆ¸</button></li>
                <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-oh">ä¸­å¤æˆ¸</button></li>
            </ul>

            <div class="tab-content shadow-sm mb-3">
                <div class="tab-pane fade show active" id="tab-rent">
                    <label class="small">å®¶è³ƒ/æœˆ (å††)</label>
                    <input type="number" id="r_price" class="form-control mb-2" value="160000">
                    <label class="small">æ›´æ–°æ–™ (2å¹´æ¯/å††)</label>
                    <input type="number" id="r_update" class="form-control mb-2" value="160000">
                    <label class="small">å®¶è³ƒä¸Šæ˜‡ç‡ (%)</label>
                    <input type="number" id="r_up" class="form-control mb-2" value="0">
                    <p class="text-muted extra-small">â€»åˆæœŸè²»ç”¨ã¯å®¶è³ƒã®5å€ã§è‡ªå‹•è¨ˆç®—</p>
                </div>

                <div class="tab-pane fade" id="tab-nm">
                    <h6>æ–°ç¯‰ãƒãƒ³ã‚·ãƒ§ãƒ³</h6>
                    <label class="small">ç‰©ä»¶ä¾¡æ ¼ (å††)</label><input type="number" id="nm_price" class="form-control mb-2" value="60000000">
                    <label class="small">ç®¡ç†ãƒ»ä¿®ç¹•è²»/æœˆ</label><input type="number" id="nm_maint" class="form-control mb-2" value="35000">
                    <label class="small">ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤åŒºåˆ†</label>
                    <select id="nm_tax" class="form-select form-select-sm mb-2">
                        <option value="4500">é•·æœŸå„ªè‰¯ãƒ»ä½ç‚­ç´  (4500ä¸‡æ )</option>
                        <option value="3500" selected>ZEHæ°´æº– (3500ä¸‡æ )</option>
                        <option value="3000">çœã‚¨ãƒåŸºæº– (3000ä¸‡æ )</option>
                    </select>
                    <label class="small">å£²å´æ™‚ä¾¡æ ¼ä¸‹è½ç‡ (å¹´%)</label><input type="number" id="nm_drop" class="form-control mb-2" value="2.0">
                </div>
                
                <div class="tab-pane fade" id="tab-om">
                    <h6>ä¸­å¤ãƒãƒ³ã‚·ãƒ§ãƒ³</h6>
                    <label class="small">ç‰©ä»¶ä¾¡æ ¼ (å††)</label><input type="number" id="om_price" class="form-control mb-2" value="45000000">
                    <label class="small">ç¯‰å¹´æ•°</label><input type="number" id="om_age" class="form-control mb-2" value="15">
                    <label class="small">ãƒªãƒ•ã‚©ãƒ¼ãƒ ä»£</label><input type="number" id="om_ref" class="form-control mb-2" value="20000000">
                    <label class="small">ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤åŒºåˆ†</label>
                    <select id="om_tax" class="form-select form-select-sm mb-2">
                        <option value="3000">çœã‚¨ãƒé©åˆä¸­å¤ (3000ä¸‡æ )</option>
                        <option value="2000" selected>ä¸€èˆ¬ä¸­å¤ (2000ä¸‡æ )</option>
                    </select>
                </div>

                <div class="tab-pane fade" id="tab-nh">
                    <h6>æ–°ç¯‰æˆ¸å»º</h6>
                    <label class="small">ç‰©ä»¶ä¾¡æ ¼ (å††)</label><input type="number" id="nh_price" class="form-control mb-2" value="55000000">
                    <label class="small">å¤§è¦æ¨¡ä¿®ç¹•è²» (10å¹´æ¯)</label><input type="number" id="nh_maint" class="form-control mb-2" value="2000000">
                    <label class="small">å£²å´æ™‚åœŸåœ°ä¾¡æ ¼æ®‹å­˜ç‡ (%)</label><input type="number" id="nh_land" class="form-control mb-2" value="60">
                </div>

                <div class="tab-pane fade" id="tab-oh">
                    <h6>ä¸­å¤æˆ¸å»º</h6>
                    <label class="small">ç‰©ä»¶ä¾¡æ ¼ (å††)</label><input type="number" id="oh_price" class="form-control mb-2" value="40000000">
                    <label class="small">å»ºç‰©æ¸›ä¾¡å„Ÿå´ç‡ (å¹´%)</label><input type="number" id="oh_dep" class="form-control mb-2" value="3.8">
                    <label class="small">å¤§è¦æ¨¡ä¿®ç¹•è²»</label><input type="number" id="oh_maint" class="form-control mb-2" value="2000000">
                </div>
            </div>

            <button class="btn btn-primary w-100 py-3 fw-bold shadow" onclick="calculateAll()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
            <div class="mt-2 text-center">
                <span class="info-btn" data-bs-toggle="modal" data-bs-target="#taxInfoModal">â„¹ï¸ ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤ã®æ¡ä»¶è¡¨ã‚’è¡¨ç¤º</span>
            </div>
        </div>

        <div class="col-xl-8 col-lg-7">
            <div class="card shadow-sm p-3 mb-3 bg-white">
                <canvas id="lineChart" height="180"></canvas>
            </div>
            <div class="table-responsive">
                <table class="table table-sm table-hover bg-white shadow-sm border">
                    <thead class="table-dark">
                        <tr>
                            <th>é …ç›® (50å¹´æ¯”è¼ƒ)</th>
                            <th>è³ƒè²¸</th>
                            <th>æ–°ç¯‰ãƒ</th>
                            <th>ä¸­å¤ãƒ</th>
                            <th>æ–°ç¯‰æˆ¸</th>
                            <th>ä¸­å¤æˆ¸</th>
                        </tr>
                    </thead>
                    <tbody id="resultTable"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="taxInfoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header"><h5>ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤ï¼ˆ2026å¹´å…¥å±…ï¼‰</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
            <div class="modal-body">
                <h6>ğŸ”¹ æ–°ç¯‰ä½å®… (æ§é™¤13å¹´ / 0.7%)</h6>
                <table class="table table-bordered small">
                    <tr class="table-light"><th>åŒºåˆ†</th><th>æ®‹é«˜ä¸Šé™</th><th>å¹´é–“æœ€å¤§</th><th>æœ€å¤§åˆè¨ˆ</th></tr>
                    <tr><td>é•·æœŸå„ªè‰¯ãƒ»ä½ç‚­ç´ </td><td>4,500ä¸‡å††</td><td>31.5ä¸‡å††</td><td>ç´„409.5ä¸‡å††</td></tr>
                    <tr><td>ZEHæ°´æº–çœã‚¨ãƒ</td><td>3,500ä¸‡å††</td><td>24.5ä¸‡å††</td><td>ç´„318.5ä¸‡å††</td></tr>
                    <tr><td>çœã‚¨ãƒåŸºæº–é©åˆ</td><td>3,000ä¸‡å††</td><td>21.0ä¸‡å††</td><td>ç´„273.0ä¸‡å††</td></tr>
                </table>
                <h6>ğŸ”¹ ä¸­å¤ä½å®… (æ§é™¤10å¹´ / 0.7%)</h6>
                <table class="table table-bordered small">
                    <tr class="table-light"><th>åŒºåˆ†</th><th>æ®‹é«˜ä¸Šé™</th><th>å¹´é–“æœ€å¤§</th><th>æœ€å¤§åˆè¨ˆ</th></tr>
                    <tr><td>çœã‚¨ãƒé©åˆä¸­å¤</td><td>3,000ä¸‡å††</td><td>21.0ä¸‡å††</td><td>210ä¸‡å††</td></tr>
                    <tr><td>ä¸€èˆ¬ä¸­å¤(è€éœ‡æœ‰)</td><td>2,000ä¸‡å††</td><td>14.0ä¸‡å††</td><td>140ä¸‡å††</td></tr>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
let chart;

function updateRate() {
    const type = document.getElementById('loan_type').value;
    const rateInput = document.getElementById('loan_rate');
    if(type === 'fixed') { rateInput.value = 2.0; rateInput.disabled = true; }
    else { rateInput.disabled = false; }
}

function calculateAll() {
    const years = parseInt(document.getElementById('sim_years').value);
    const inflation = parseFloat(document.getElementById('inflation').value) / 100;
    const isPair = parseInt(document.getElementById('is_pair').value);
    const loanRate = parseFloat(document.getElementById('loan_rate').value) / 100 / 12;
    const loanTerm = parseInt(document.getElementById('loan_term').value) * 12;

    const scenarios = [
        { id: 'r', name: 'è³ƒè²¸' },
        { id: 'nm', name: 'æ–°ç¯‰ãƒ' },
        { id: 'om', name: 'ä¸­å¤ãƒ' },
        { id: 'nh', name: 'æ–°ç¯‰æˆ¸' },
        { id: 'oh', name: 'ä¸­å¤æˆ¸' }
    ];

    let results = {};
    let chartData = { labels: [], datasets: [] };

    // ã‚°ãƒ©ãƒ•ç”¨ãƒ©ãƒ™ãƒ« (å¹´)
    for(let y=1; y<=years; y++) chartData.labels.push(y + "å¹´");

    scenarios.forEach(sc => {
        let totalOut = 0;
        let assetValue = 0;
        let yearlyCosts = [];
        
        if(sc.id === 'r') {
            // è³ƒè²¸ãƒ­ã‚¸ãƒƒã‚¯
            const base = parseFloat(document.getElementById('r_price').value);
            const update = parseFloat(document.getElementById('r_update').value);
            totalOut = base * 5; // åˆæœŸè²»ç”¨
            for(let y=1; y<=years; y++) {
                let yCost = (base * 12) * Math.pow(1+inflation, y);
                if(y % 2 === 0) yCost += update;
                totalOut += yCost;
                yearlyCosts.push(totalOut);
            }
        } else {
            // è³¼å…¥ãƒ­ã‚¸ãƒƒã‚¯å…±é€š
            const price = parseFloat(document.getElementById(sc.id + '_price').value);
            const taxLimit = parseInt(document.getElementById(sc.id + '_tax')?.value || 2000) * 10000 * isPair;
            const taxYears = (sc.id.startsWith('n')) ? 13 : 10;
            
            // ãƒ­ãƒ¼ãƒ³è¨ˆç®—
            const monthlyPayment = (price * loanRate * Math.pow(1+loanRate, loanTerm)) / (Math.pow(1+loanRate, loanTerm)-1);
            let loanBalance = price;
            totalOut = price * 0.05; // è«¸è²»ç”¨5%
            if(sc.id === 'om') totalOut += parseFloat(document.getElementById('om_ref').value);

            for(let y=1; y<=years; y++) {
                let yOut = 0;
                // ãƒ­ãƒ¼ãƒ³æ”¯æ‰•ã„
                if(y <= loanTerm/12) {
                    yOut += monthlyPayment * 12;
                    // æ§é™¤è¨ˆç®—
                    if(y <= taxYears) {
                        const deduction = Math.min(loanBalance, taxLimit) * 0.007;
                        yOut -= deduction;
                    }
                    // æ®‹é«˜æ›´æ–° (æ¦‚ç®—)
                    loanBalance -= (monthlyPayment * 12 - (loanBalance * loanRate * 12));
                }
                
                // ç¶­æŒè²»ãƒ»å›ºå®šè³‡ç”£ç¨
                yOut += (price * 0.004); // å›ºå®šè³‡ç”£ç¨æ¦‚ç®—
                if(sc.id.includes('m')) {
                    yOut += parseFloat(document.getElementById(sc.id + '_maint').value) * 12;
                } else {
                    if(y % 10 === 0) yOut += parseFloat(document.getElementById(sc.id + '_maint').value);
                }

                totalOut += yOut;
                
                // è³‡ç”£ä¾¡å€¤ã®æ¦‚ç®—
                if(y === years) {
                   if(sc.id.includes('m')) assetValue = price * Math.pow(0.97, y); // ãƒãƒ³ã‚·ãƒ§ãƒ³3%ä¸‹è½
                   else assetValue = price * 0.5; // æˆ¸å»ºã¯åœŸåœ°å€¤50%å›ºå®š
                }
                yearlyCosts.push(totalOut);
            }
        }
        results[sc.id] = { total: totalOut, real: totalOut - assetValue, costs: yearlyCosts };
    });

    renderTable(results);
    renderChart(chartData, results);
}

function renderTable(res) {
    const years = parseInt(document.getElementById('sim_years').value);
    const html = `
        <tr><td>ç·æ”¯æ‰•é¡</td><td>${Math.round(res.r.total/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.nm.total/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.om.total/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.nh.total/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.oh.total/10000).toLocaleString()}ä¸‡</td></tr>
        <tr class="table-warning fw-bold"><td>å®Ÿè³ªã‚³ã‚¹ãƒˆ</td><td>${Math.round(res.r.real/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.nm.real/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.om.real/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.nh.real/10000).toLocaleString()}ä¸‡</td><td>${Math.round(res.oh.real/10000).toLocaleString()}ä¸‡</td></tr>
        <tr><td>æœˆé¡å®Ÿè³ªè² æ‹…</td><td>${Math.round(res.r.real/years/12).toLocaleString()}å††</td><td>${Math.round(res.nm.real/years/12).toLocaleString()}å††</td><td>${Math.round(res.om.real/years/12).toLocaleString()}å††</td><td>${Math.round(res.nh.real/years/12).toLocaleString()}å††</td><td>${Math.round(res.oh.real/years/12).toLocaleString()}å††</td></tr>
    `;
    document.getElementById('resultTable').innerHTML = html;
}

function renderChart(data, res) {
    const ctx = document.getElementById('lineChart').getContext('2d');
    if(chart) chart.destroy();
    chart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: data.labels,
            datasets: [
                { label: 'è³ƒè²¸', data: res.r.costs, borderColor: '#198754', tension: 0.1 },
                { label: 'æ–°ç¯‰ãƒ', data: res.nm.costs, borderColor: '#0d6efd', tension: 0.1 },
                { label: 'ä¸­å¤ãƒ', data: res.om.costs, borderColor: '#0dcaf0', tension: 0.1 },
                { label: 'æ–°ç¯‰æˆ¸', data: res.nh.costs, borderColor: '#fd7e14', tension: 0.1 },
                { label: 'ä¸­å¤æˆ¸', data: res.oh.costs, borderColor: '#6f42c1', tension: 0.1 }
            ]
        },
        options: { plugins: { title: { display: true, text: 'ç´¯è¨ˆæ”¯å‡ºæ¨ç§» (ä½å®…ãƒ­ãƒ¼ãƒ³æ§é™¤åæ˜ æ¸ˆ)' } } }
    });
}

window.onload = calculateAll;
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
