<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒ Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2563eb; /* æŒã¡å®¶ï¼šé’ */
            --success: #16a34a; /* è³ƒè²¸ï¼šç·‘ */
            --warning: #ea580c; /* æ³¨æ„ãƒ»æˆ¸å»ºï¼šã‚ªãƒ¬ãƒ³ã‚¸ */
            --secondary: #64748b;
            --bg: #f1f5f9;
            --card-border: #e2e8f0;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; line-height: 1.6; color: #1e293b; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1000px; margin: 0 auto; }
        h1 { font-size: 1.4rem; color: #0f172a; text-align: center; margin-bottom: 1.5rem; }
        
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .field { margin-bottom: 10px; }
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 5px; display: flex; align-items: center; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        /* è³ƒè²¸/ç‰©ä»¶é¸æŠã‚¿ãƒ– */
        .tabs { display: flex; gap: 5px; margin-bottom: 15px; overflow-x: auto; white-space: nowrap; -webkit-overflow-scrolling: touch; }
        .tab-btn { padding: 10px 15px; border: none; background: #e2e8f0; cursor: pointer; color: var(--secondary); border-radius: 8px; font-size: 0.9rem; flex: 1; }
        .tab-btn.active { background: var(--primary); color: white; font-weight: bold; }

        .main-btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: bold; margin-top: 10px; transition: opacity 0.2s; }
        .main-btn:active { opacity: 0.8; }

        /* çµæœã‚µãƒãƒªãƒ¼ */
        .res-display { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; margin-top: 10px; }
        .res-item { background: #f8fafc; padding: 15px; border-radius: 8px; border-top: 4px solid #ddd; text-align: center; }
        .res-item.rent { border-top-color: var(--success); }
        .res-item.mansion { border-top-color: var(--primary); }
        .res-item.house { border-top-color: var(--warning); }
        .res-val { font-size: 1.2rem; font-weight: bold; display: block; margin-top: 5px; }
        .res-sub { font-size: 0.75rem; color: #64748b; }

        /* æœˆã€…ã®å†…è¨³ï¼ˆSUUMOé¢¨ï¼‰ */
        .monthly-box { margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 12px; border: 1px dashed var(--primary); }
        .monthly-total { font-size: 1.5rem; font-weight: bold; color: var(--primary); text-align: center; }
        
        .chart-container { position: relative; height: 300px; width: 100%; margin-top: 20px; }
        .table-wrapper { overflow-x: auto; margin-top: 20px; border-radius: 8px; border: 1px solid var(--card-border); }
        table { width: 100%; border-collapse: collapse; font-size: 0.85rem; background: white; }
        th { background: #f8fafc; padding: 12px; border-bottom: 2px solid var(--card-border); }
        td { padding: 12px; text-align: center; border-bottom: 1px solid var(--card-border); }

        .info-trigger { margin-left: 6px; cursor: pointer; background: var(--secondary); color: white; width: 18px; height: 18px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; font-size: 11px; border: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ  ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ Pro</h1>

    <div class="card">
        <label style="font-size: 1rem; margin-bottom: 15px; color: var(--primary);">1. åŸºæœ¬ãƒ»ãƒ­ãƒ¼ãƒ³è¨­å®š</label>
        <div class="grid">
            <div class="field">
                <label>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æœŸé–“</label>
                <select id="sim_years">
                    <option value="35">35å¹´</option>
                    <option value="50" selected>50å¹´</option>
                </select>
            </div>
            <div class="field">
                <label>ãƒšã‚¢ãƒ­ãƒ¼ãƒ³<button class="info-trigger">?</button></label>
                <select id="is_pair">
                    <option value="1">ãªã—</option>
                    <option value="2" selected>ã‚ã‚Š (æ 2å€)</option>
                </select>
            </div>
            <div class="field">
                <label>ä½å®…ãƒ­ãƒ¼ãƒ³é‡‘åˆ© (%)</label>
                <input type="number" id="loan_rate" value="0.5" step="0.1">
            </div>
            <div class="field">
                <label>ãƒ­ãƒ¼ãƒ³æœŸé–“ (å¹´)</label>
                <input type="number" id="loan_term" value="35">
            </div>
        </div>
    </div>

    <div class="card">
        <label style="font-size: 1rem; margin-bottom: 15px; color: var(--primary);">2. ç‰©ä»¶ãƒ»å®¶è³ƒãƒ—ãƒ©ãƒ³ã®ç·¨é›†</label>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('rent', this)">è³ƒè²¸</button>
            <button class="tab-btn" onclick="switchTab('nm', this)">æ–°ç¯‰ãƒ</button>
            <button class="tab-btn" onclick="switchTab('om', this)">ä¸­å¤ãƒ</button>
            <button class="tab-btn" onclick="switchTab('nh', this)">æ–°ç¯‰æˆ¸å»º</button>
            <button class="tab-btn" onclick="switchTab('oh', this)">ä¸­å¤æˆ¸å»º</button>
        </div>

        <div id="panel-rent" class="tab-panel">
            <div class="grid">
                <div class="field">
                    <label>æœˆé¡å®¶è³ƒ (ä¸‡å††)</label>
                    <input type="number" id="r_price" value="16" oninput="liveCalc()">
                </div>
                <div class="field">
                    <label>æ›´æ–°æ–™ (å¹´æ•°/å›)</label>
                    <input type="number" id="r_update" value="2" readonly>
                </div>
            </div>
        </div>

        <div id="panel-buy" class="tab-panel" style="display:none;">
            <div class="grid">
                <div class="field">
                    <label>ç‰©ä»¶ä¾¡æ ¼ (ä¸‡å††)</label>
                    <input type="number" id="b_price" value="6000" oninput="liveCalc()">
                </div>
                <div class="field" id="field-ref">
                    <label>ãƒªãƒ•ã‚©ãƒ¼ãƒ è²» (ä¸‡å††)</label>
                    <input type="number" id="b_ref" value="0" oninput="liveCalc()">
                </div>
                <div class="field">
                    <label>ç®¡ç†è²»/æœˆ (ä¸‡å††)</label>
                    <input type="number" id="b_maint_1" value="1.5" oninput="liveCalc()">
                </div>
                <div class="field">
                    <label>ä¿®ç¹•ç©ç«‹/æœˆ (ä¸‡å††)</label>
                    <input type="number" id="b_maint_2" value="2.0" oninput="liveCalc()">
                </div>
            </div>
        </div>

        <div class="monthly-box">
            <div class="res-sub" style="text-align: center;">ã“ã®ãƒ—ãƒ©ãƒ³ã®æœˆã€…æ”¯æ‰•é¡ (ç›®å®‰)</div>
            <div class="monthly-total" id="live_monthly">-- ä¸‡å††</div>
            <div id="mini_chart_area" style="height: 60px; margin-top:10px;">
                <canvas id="miniChart"></canvas>
            </div>
        </div>

        <button class="main-btn" onclick="runSimulation()">ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆã‚’æ¯”è¼ƒã™ã‚‹</button>
    </div>

    <div id="resultArea" style="display:none;">
        <div class="card">
            <label style="font-size: 1rem; margin-bottom: 15px; color: var(--primary);">3. ç´¯è¨ˆæ”¯å‡ºã®æ¯”è¼ƒ</label>
            <div class="res-display" id="summaryGrid">
                </div>
            <div class="chart-container">
                <canvas id="mainChart"></canvas>
            </div>
            <div class="table-wrapper">
                <table id="resTable">
                    <thead>
                        <tr><th>ãƒ—ãƒ©ãƒ³</th><th>ç·æ”¯æ‰•é¡</th><th>å®Ÿè³ªã‚³ã‚¹ãƒˆ</th></tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    let activeTab = 'rent';
    let mainChart = null;
    let miniChart = null;

    // ç‰©ä»¶ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸå€¤
    const defaults = {
        rent: { price: 16, maint1: 0, maint2: 0, ref: 0 },
        nm: { price: 6000, maint1: 1.5, maint2: 2.0, ref: 0 },
        om: { price: 4500, maint1: 1.8, maint2: 2.5, ref: 1500 },
        nh: { price: 5500, maint1: 0.5, maint2: 1.0, ref: 0 },
        oh: { price: 3800, maint1: 0.5, maint2: 1.5, ref: 1000 }
    };

    function switchTab(type, btn) {
        activeTab = type;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        if(type === 'rent') {
            document.getElementById('panel-rent').style.display = 'block';
            document.getElementById('panel-buy').style.display = 'none';
        } else {
            document.getElementById('panel-rent').style.display = 'none';
            document.getElementById('panel-buy').style.display = 'block';
            // å„ç‰©ä»¶ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ã‚»ãƒƒãƒˆ
            document.getElementById('b_price').value = defaults[type].price;
            document.getElementById('b_maint_1').value = defaults[type].maint1;
            document.getElementById('b_maint_2').value = defaults[type].maint2;
            document.getElementById('b_ref').value = defaults[type].ref;
            document.getElementById('field-ref').style.display = (type.includes('o')) ? 'block' : 'none';
        }
        liveCalc();
    }

    function getLoanMonthly(principal, yearlyRate, years) {
        if(yearlyRate <= 0) return principal / (years * 12);
        const r = yearlyRate / 100 / 12;
        const n = years * 12;
        return principal * r * Math.pow(1 + r, n) / (Math.pow(1 + r, n) - 1);
    }

    function liveCalc() {
        let total = 0;
        let loan = 0, m1 = 0, m2 = 0;

        if(activeTab === 'rent') {
            loan = parseFloat(document.getElementById('r_price').value) || 0;
            total = loan;
        } else {
            const price = parseFloat(document.getElementById('b_price').value) || 0;
            const rate = parseFloat(document.getElementById('loan_rate').value) || 0;
            const term = parseFloat(document.getElementById('loan_term').value) || 35;
            loan = getLoanMonthly(price, rate, term);
            m1 = parseFloat(document.getElementById('b_maint_1').value) || 0;
            m2 = parseFloat(document.getElementById('b_maint_2').value) || 0;
            total = loan + m1 + m2;
        }

        document.getElementById('live_monthly').innerText = total.toFixed(1) + " ä¸‡å††";
        updateMiniChart(loan, m1, m2);
    }

    function updateMiniChart(loan, m1, m2) {
        const ctx = document.getElementById('miniChart').getContext('2d');
        if(miniChart) miniChart.destroy();
        miniChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['å†…è¨³'],
                datasets: [
                    { label: 'ãƒ­ãƒ¼ãƒ³/å®¶è³ƒ', data: [loan], backgroundColor: '#2563eb' },
                    { label: 'ç®¡ç†è²»', data: [m1], backgroundColor: '#64748b' },
                    { label: 'ä¿®ç¹•/ä»–', data: [m2], backgroundColor: '#ea580c' }
                ]
            },
            options: {
                indexAxis: 'y',
                plugins: { legend: { display: false } },
                scales: { x: { stacked: true, display: false }, y: { stacked: true, display: false } },
                maintainAspectRatio: false
            }
        });
    }

    function runSimulation() {
        document.getElementById('resultArea').style.display = 'block';
        const years = parseInt(document.getElementById('sim_years').value);
        const ids = ['rent', 'nm', 'om', 'nh', 'oh'];
        const labels = ['è³ƒè²¸', 'æ–°ç¯‰ãƒ', 'ä¸­å¤ãƒ', 'æ–°ç¯‰æˆ¸', 'ä¸­å¤æˆ¸'];
        const colors = ['#16a34a', '#2563eb', '#0ea5e9', '#ea580c', '#8b5cf6'];
        
        let chartDatasets = [];
        let tableHtml = '';
        let summaryHtml = '';

        ids.forEach((id, idx) => {
            let total = 0;
            let history = [];
            const d = (id === activeTab && id !== 'rent') ? {
                price: parseFloat(document.getElementById('b_price').value),
                maint1: parseFloat(document.getElementById('b_maint_1').value),
                maint2: parseFloat(document.getElementById('b_maint_2').value),
                ref: parseFloat(document.getElementById('b_ref').value)
            } : (id === activeTab && id === 'rent') ? {
                price: parseFloat(document.getElementById('r_price').value)
            } : defaults[id];

            if(id === 'rent') {
                total = d.price * 5; // åˆæœŸè²»ç”¨
                for(let y=1; y<=years; y++) {
                    total += (d.price * 12);
                    if(y % 2 === 0) total += d.price; // æ›´æ–°æ–™
                    history.push(Math.round(total));
                }
            } else {
                const loanM = getLoanMonthly(d.price, 0.5, 35);
                total = d.price * 0.05 + (d.ref || 0);
                for(let y=1; y<=years; y++) {
                    if(y <= 35) total += (loanM * 12);
                    total += (d.maint1 + d.maint2) * 12;
                    history.push(Math.round(total));
                }
            }

            chartDatasets.push({
                label: labels[idx],
                data: history,
                borderColor: colors[idx],
                borderWidth: id === activeTab ? 4 : 2,
                tension: 0.1,
                pointRadius: 0
            });

            tableHtml += `<tr><td>${labels[idx]}</td><td>${total.toLocaleString()}ä¸‡</td><td>${(total*0.8).toFixed(0)}ä¸‡</td></tr>`;
            
            const cardClass = id === 'rent' ? 'rent' : (id.includes('m') ? 'mansion' : 'house');
            summaryHtml += `
                <div class="res-item ${cardClass}">
                    <div class="res-sub">${labels[idx]} (ç´¯è¨ˆ)</div>
                    <div class="res-val">${Math.round(total/10000 * 10) / 10} å„„å††</div>
                </div>`;
        });

        // ã‚°ãƒ©ãƒ•æ›´æ–°
        const ctx = document.getElementById('mainChart').getContext('2d');
        if(mainChart) mainChart.destroy();
        mainChart = new Chart(ctx, {
            type: 'line',
            data: { labels: Array.from({length: years}, (_, i) => i + 1), datasets: chartDatasets },
            options: { responsive: true, maintainAspectRatio: false }
        });

        document.getElementById('resTable').querySelector('tbody').innerHTML = tableHtml;
        document.getElementById('summaryGrid').innerHTML = summaryHtml;
        
        // çµæœã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        document.getElementById('resultArea').scrollIntoView({ behavior: 'smooth' });
    }

    // åˆæœŸåŒ–
    window.onload = () => {
        liveCalc();
    };
</script>

</body>
</html>
