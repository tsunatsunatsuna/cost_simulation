<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒ 2026</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --main-bg: #f8f9fa; }
        body { background-color: var(--main-bg); font-family: sans-serif; }
        .card { border-radius: 12px; border: none; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .info-mark { cursor: pointer; color: #0d6efd; font-size: 0.85rem; text-decoration: underline; margin-left: 3px; }
        .tab-content { background: #fff; padding: 20px; border-radius: 0 0 12px 12px; border: 1px solid #dee2e6; border-top: none; }
        .monthly-card { background: #e9ecef; border-radius: 8px; padding: 15px; margin-top: 15px; border-left: 5px solid #0d6efd; }
        .monthly-price { font-size: 1.5rem; font-weight: bold; color: #333; }
        .mini-chart-container { height: 120px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="container py-4">
    <h2 class="text-center mb-4 text-primary fw-bold">ğŸ  ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒ</h2>

    <div class="row">
        <div class="col-xl-5 col-lg-6">
            <div class="card p-3">
                <h6 class="fw-bold border-bottom pb-2">1. å…±é€šãƒ»ãƒ­ãƒ¼ãƒ³è¨­å®š</h6>
                <div class="row g-2 mt-1">
                    <div class="col-4"><label class="small">æ¯”è¼ƒå¹´æ•°</label>
                        <select id="sim_years" class="form-select form-select-sm">
                            <option value="10">10å¹´</option><option value="20">20å¹´</option><option value="35">35å¹´</option><option value="50" selected>50å¹´</option>
                        </select>
                    </div>
                    <div class="col-4"><label class="small">ä¸–å¸¯å¹´å(ä¸‡)</label><input type="number" id="income" class="form-control form-control-sm" value="800"></div>
                    <div class="col-4"><label class="small">ãƒšã‚¢ãƒ­ãƒ¼ãƒ³ <span class="info-mark" data-bs-toggle="modal" data-bs-target="#pairModal">â“˜</span></label>
                        <select id="is_pair" class="form-select form-select-sm"><option value="1">ãªã—</option><option value="2" selected>ã‚ã‚Š</option></select>
                    </div>
                    <div class="col-4"><label class="small">é‡‘åˆ©ã‚¿ã‚¤ãƒ—</label>
                        <select id="loan_type" class="form-select form-select-sm" onchange="updateRate()"><option value="flex">å¤‰å‹•</option><option value="fixed">å›ºå®š(2%)</option></select>
                    </div>
                    <div class="col-4"><label class="small">é‡‘åˆ©(%)</label><input type="number" id="loan_rate" class="form-control form-control-sm" value="0.5" step="0.1"></div>
                    <div class="col-4"><label class="small">æœŸé–“(å¹´)</label><input type="number" id="loan_term" class="form-control form-control-sm" value="35"></div>
                </div>
            </div>

            <ul class="nav nav-pills nav-fill mt-3 mb-0" id="mainTabs">
                <li class="nav-item"><button class="nav-link active small" data-bs-toggle="tab" data-bs-target="#t-rent">è³ƒè²¸</button></li>
                <li class="nav-item"><button class="nav-link small" data-bs-toggle="tab" data-bs-target="#t-nm">æ–°ç¯‰ãƒ</button></li>
                <li class="nav-item"><button class="nav-link small" data-bs-toggle="tab" data-bs-target="#t-om">ä¸­å¤ãƒ</button></li>
                <li class="nav-item"><button class="nav-link small" data-bs-toggle="tab" data-bs-target="#t-nh">æ–°ç¯‰æˆ¸</button></li>
                <li class="nav-item"><button class="nav-link small" data-bs-toggle="tab" data-bs-target="#t-oh">ä¸­å¤æˆ¸</button></li>
            </ul>

            <div class="tab-content shadow-sm">
                <div class="tab-pane fade show active" id="t-rent">
                    <label class="small">æœˆé¡å®¶è³ƒ: <b id="rent_val">16</b>ä¸‡å††</label>
                    <input type="range" id="r_price" class="form-range" min="5" max="50" value="16" oninput="liveUpdate('r')">
                    <div class="monthly-card">
                        <div class="small text-secondary">æœˆã€…ã®æ”¯æ‰•é¡</div>
                        <div class="monthly-price" id="r_monthly_total">0å††</div>
                    </div>
                </div>

                <div class="tab-pane fade" id="t-nm">
                    <div class="row g-2">
                        <div class="col-6"><label class="small">ä¾¡æ ¼(ä¸‡å††)</label><input type="number" id="nm_price" class="form-control" value="6000" oninput="liveUpdate('nm')"></div>
                        <div class="col-6"><label class="small">ç®¡ç†è²»/æœˆ(ä¸‡)</label><input type="number" id="nm_maint_1" class="form-control" value="1.5" oninput="liveUpdate('nm')"></div>
                        <div class="col-6"><label class="small">ä¿®ç¹•ç©ç«‹/æœˆ(ä¸‡)</label><input type="number" id="nm_maint_2" class="form-control" value="2.0" oninput="liveUpdate('nm')"></div>
                        <div class="col-6"><label class="small">æ§é™¤åŒºåˆ†</label><select id="nm_tax" class="form-select" onchange="liveUpdate('nm')"><option value="3500">ZEH(3500ä¸‡)</option><option value="4500">é•·æœŸ(4500ä¸‡)</option></select></div>
                    </div>
                    <div id="nm_monthly_area"></div>
                </div>

                <div class="tab-pane fade" id="t-om">
                    <div class="row g-2">
                        <div class="col-6"><label class="small">ä¾¡æ ¼(ä¸‡å††)</label><input type="number" id="om_price" class="form-control" value="4500" oninput="liveUpdate('om')"></div>
                        <div class="col-6"><label class="small">ãƒªãƒ•ã‚©ãƒ¼ãƒ (ä¸‡)</label><input type="number" id="om_ref" class="form-control" value="1500" oninput="liveUpdate('om')"></div>
                        <div class="col-6"><label class="small">ç®¡ç†è²»/æœˆ(ä¸‡)</label><input type="number" id="om_maint_1" class="form-control" value="1.8" oninput="liveUpdate('om')"></div>
                        <div class="col-6"><label class="small">ä¿®ç¹•ç©ç«‹/æœˆ(ä¸‡)</label><input type="number" id="om_maint_2" class="form-control" value="2.5" oninput="liveUpdate('om')"></div>
                    </div>
                    <div id="om_monthly_area"></div>
                </div>

                <div class="tab-pane fade" id="t-nh">
                    <div class="row g-2">
                        <div class="col-12"><label class="small">ä¾¡æ ¼(ä¸‡å††)</label><input type="number" id="nh_price" class="form-control" value="5500" oninput="liveUpdate('nh')"></div>
                        <div class="col-12"><label class="small">ä¿®ç¹•ç©ç«‹(å°†æ¥ç”¨)/æœˆ(ä¸‡)</label><input type="number" id="nh_maint_1" class="form-control" value="1.5" oninput="liveUpdate('nh')"></div>
                    </div>
                    <div id="nh_monthly_area"></div>
                </div>

                <div class="tab-pane fade" id="t-oh">
                    <div class="row g-2">
                        <div class="col-6"><label class="small">ä¾¡æ ¼(ä¸‡å††)</label><input type="number" id="oh_price" class="form-control" value="3800" oninput="liveUpdate('oh')"></div>
                        <div class="col-6"><label class="small">ä¿®ç¹•ç”¨ç©ç«‹/æœˆ(ä¸‡)</label><input type="number" id="oh_maint_1" class="form-control" value="2.0" oninput="liveUpdate('oh')"></div>
                    </div>
                    <div id="oh_monthly_area"></div>
                </div>
            </div>

            <button class="btn btn-primary w-100 py-3 mt-3 fw-bold shadow-sm" onclick="calculateFinal()">50å¹´ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ</button>
        </div>

        <div class="col-xl-7 col-lg-6 mt-4 mt-lg-0">
            <div class="card p-3 h-100">
                <canvas id="mainChart"></canvas>
                <div class="table-responsive mt-3">
                    <table class="table table-sm table-bordered text-center small">
                        <thead class="table-dark">
                            <tr><th>ç´¯è¨ˆæ¯”è¼ƒ</th><th>è³ƒè²¸</th><th>æ–°ç¯‰ãƒ</th><th>ä¸­å¤ãƒ</th><th>æ–°ç¯‰æˆ¸</th><th>ä¸­å¤æˆ¸</th></tr>
                        </thead>
                        <tbody id="resTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="pairModal" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-body small">ãƒšã‚¢ãƒ­ãƒ¼ãƒ³ã®å ´åˆã€æ§é™¤æ ãŒ2äººåˆ†åˆç®—ã•ã‚Œã¾ã™ã€‚</div></div></div></div>

<script>
let mainChart;
let miniCharts = {};

// ç‰©ä»¶ã”ã¨ã®æœˆã€…æ”¯æ‰•é¡ã‚’è¡¨ç¤ºã™ã‚‹HTMLãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ç”Ÿæˆ
function injectMonthlyArea(id) {
    const target = document.getElementById(id + '_monthly_area');
    if(!target) return;
    target.innerHTML = `
        <div class="monthly-card">
            <div class="small text-secondary">æœˆã€…ã®æ”¯æ‰•é¡ (æ¦‚ç®—)</div>
            <div class="monthly-price" id="${id}_monthly_total">0å††</div>
            <div class="mini-chart-container"><canvas id="${id}_mini_chart"></canvas></div>
        </div>
    `;
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å„ã‚¿ãƒ–ã«ã‚¨ãƒªã‚¢ã‚’æŒ¿å…¥
['nm', 'om', 'nh', 'oh'].forEach(id => injectMonthlyArea(id));

function getLoanMonthly(principal, yearlyRate, years) {
    if(yearlyRate === 0) return principal / (years * 12);
    const r = yearlyRate / 12;
    const n = years * 12;
    return (principal * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
}

function liveUpdate(type) {
    const rate = parseFloat(document.getElementById('loan_rate').value) / 100;
    const term = parseInt(document.getElementById('loan_term').value);

    if(type === 'r') {
        const val = document.getElementById('r_price').value;
        document.getElementById('rent_val').innerText = val;
        document.getElementById('r_monthly_total').innerText = (val * 10000).toLocaleString() + "å††";
        return;
    }

    const price = parseFloat(document.getElementById(type + '_price').value) || 0;
    const loanMonthly = getLoanMonthly(price * 10000, rate, term);
    const maint1 = (parseFloat(document.getElementById(type + '_maint_1')?.value) || 0) * 10000;
    const maint2 = (parseFloat(document.getElementById(type + '_maint_2')?.value) || 0) * 10000;
    
    const total = loanMonthly + maint1 + maint2;
    document.getElementById(type + '_monthly_total').innerText = Math.round(total).toLocaleString() + "å††";

    // ãƒŸãƒ‹æ£’ã‚°ãƒ©ãƒ•æ›´æ–°
    updateMiniChart(type, loanMonthly, maint1, maint2);
}

function updateMiniChart(type, loan, m1, m2) {
    const ctx = document.getElementById(type + '_mini_chart').getContext('2d');
    if(miniCharts[type]) miniCharts[type].destroy();
    
    miniCharts[type] = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['æœˆé¡å†…è¨³'],
            datasets: [
                { label: 'ãƒ­ãƒ¼ãƒ³è¿”æ¸ˆ', data: [Math.round(loan)], backgroundColor: '#0d6efd' },
                { label: 'ç®¡ç†è²»ç­‰', data: [Math.round(m1)], backgroundColor: '#6c757d' },
                { label: 'ä¿®ç¹•ç©ç«‹', data: [Math.round(m2)], backgroundColor: '#ffc107' }
            ]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: { x: { stacked: true, display: false }, y: { stacked: true, display: false } }
        }
    });
}

function calculateFinal() {
    const years = parseInt(document.getElementById('sim_years').value);
    const ids = ['r', 'nm', 'om', 'nh', 'oh'];
    let chartData = { labels: [], datasets: [] };
    let finalSummary = {};

    for(let i=1; i<=years; i++) chartData.labels.push(i + "å¹´");

    ids.forEach((id, idx) => {
        let history = [];
        let total = 0;
        const color = ['#198754', '#0d6efd', '#0dcaf0', '#fd7e14', '#6f42c1'][idx];

        if(id === 'r') {
            const rent = parseFloat(document.getElementById('r_price').value) * 10000;
            total = rent * 5; // åˆæœŸè²»ç”¨
            for(let y=1; y<=years; y++) {
                total += (rent * 12);
                if(y % 2 === 0) total += rent;
                history.push(total / 10000);
            }
        } else {
            const price = parseFloat(document.getElementById(id + '_price').value) * 10000;
            const m1 = (parseFloat(document.getElementById(id + '_maint_1')?.value) || 0) * 10000;
            const m2 = (parseFloat(document.getElementById(id + '_maint_2')?.value) || 0) * 10000;
            const loanRate = parseFloat(document.getElementById('loan_rate').value) / 100;
            const loanTerm = parseInt(document.getElementById('loan_term').value);
            const mLoan = getLoanMonthly(price, loanRate, loanTerm);

            total = price * 0.05; // è«¸è²»ç”¨
            if(id === 'om') total += (parseFloat(document.getElementById('om_ref').value) || 0) * 10000;

            for(let y=1; y<=years; y++) {
                if(y <= loanTerm) total += (mLoan * 12);
                total += (m1 + m2) * 12;
                history.push(total / 10000);
            }
        }
        
        chartData.datasets.push({ label: id, data: history, borderColor: color, tension: 0.1 });
        finalSummary[id] = total;
    });

    // ãƒ¡ã‚¤ãƒ³ã‚°ãƒ©ãƒ•æç”»
    const ctx = document.getElementById('mainChart').getContext('2d');
    if(mainChart) mainChart.destroy();
    mainChart = new Chart(ctx, { type: 'line', data: chartData });

    // ãƒ†ãƒ¼ãƒ–ãƒ«æç”»
    const rowH = (val) => Math.round(val / 10000).toLocaleString() + "ä¸‡";
    document.getElementById('resTable').innerHTML = `
        <tr><td>ç·æ”¯æ‰•</td><td>${rowH(finalSummary.r)}</td><td>${rowH(finalSummary.nm)}</td><td>${rowH(finalSummary.om)}</td><td>${rowH(finalSummary.nh)}</td><td>${rowH(finalSummary.oh)}</td></tr>
    `;
}

function updateRate() {
    const val = document.getElementById('loan_type').value === 'fixed' ? 2.0 : 0.5;
    document.getElementById('loan_rate').value = val;
}

window.onload = () => {
    ['nm', 'om', 'nh', 'oh', 'r'].forEach(id => liveUpdate(id));
    calculateFinal();
};
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
