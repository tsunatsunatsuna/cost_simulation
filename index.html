<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒ Pro v14</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --color-rent: #16a34a; --color-nm: #2563eb; --color-om: #0ea5e9;
            --color-nh: #ea580c; --color-oh: #8b5cf6; --secondary: #64748b; --bg: #f1f5f9;
        }
        body { font-family: -apple-system, sans-serif; color: #1e293b; background-color: var(--bg); margin: 0; padding: 10px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; position: relative; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        label { display: block; font-size: 0.75rem; font-weight: 600; margin-bottom: 4px; color: #475569; display: flex; align-items: center; }
        input, select { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 14px; box-sizing: border-box; }
        
        .tabs { display: flex; gap: 4px; margin-bottom: 15px; overflow-x: auto; }
        .tab-btn { padding: 12px 8px; border: none; background: #e2e8f0; cursor: pointer; border-radius: 8px; font-size: 0.8rem; flex: 1; font-weight: bold; white-space: nowrap; }
        .tab-btn.active { color: white; }
        .tab-btn[data-type="rent"].active { background: var(--color-rent); }
        .tab-btn[data-type="nm"].active { background: var(--color-nm); }
        .tab-btn[data-type="om"].active { background: var(--color-om); }
        .tab-btn[data-type="nh"].active { background: var(--color-nh); }
        .tab-btn[data-type="oh"].active { background: var(--color-oh); }

        .monthly-box { margin-top: 15px; padding: 15px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0; }
        .monthly-total { font-size: 1.7rem; font-weight: bold; color: #0f172a; text-align: center; }
        
        .res-table { width: 100%; border-collapse: collapse; font-size: 0.65rem; min-width: 950px; margin-top: 15px;}
        .res-table th, .res-table td { border-bottom: 1px solid #e2e8f0; padding: 10px 6px; text-align: right; }
        .res-table th { background: #f8fafc; color: var(--secondary); }
        .res-table .row-label { text-align: left; font-weight: bold; font-size: 0.8rem; padding-left: 10px; border-left: 6px solid transparent; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: white; padding: 25px; border-radius: 12px; width: 100%; max-width: 800px; max-height: 85vh; overflow-y: auto; }
        .info-btn { background: var(--secondary); color: white; border: none; width: 22px; height: 22px; border-radius: 50%; cursor: pointer; font-size: 12px; margin-left: 5px; }
        .close-btn { background: #0f172a; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; margin-top: 15px; cursor: pointer; }
        
        .section-title { font-size: 1.1rem; font-weight: bold; margin: 20px 0 10px; border-left: 4px solid #0f172a; padding-left: 10px; }
        .chart-controls { display: flex; gap: 15px; margin-bottom: 10px; background: #f8fafc; padding: 10px; border-radius: 8px; font-size: 0.85rem; }
        .tax-table { width: 100%; border-collapse: collapse; font-size: 0.75rem; margin: 10px 0; }
        .tax-table th, .tax-table td { border: 1px solid #e2e8f0; padding: 8px; text-align: center; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align:center">ğŸ  ä½ã¾ã„ã®ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¯”è¼ƒ Pro v14</h1>

    <div class="card">
        <div class="section-title">1. åŸºæœ¬ãƒ­ãƒ¼ãƒ³ãƒ»ä¸–å¸¯è¨­å®š</div>
        <div class="grid">
            <div class="field"><label>é‡‘åˆ© (%)</label><input type="number" id="global_rate" value="1.5" step="0.1" oninput="liveCalc()"></div>
            <div class="field"><label>è¿”æ¸ˆæœŸé–“ (å¹´)</label><input type="number" id="global_term" value="35" oninput="liveCalc()"></div>
            <div class="field"><label>ä¸–å¸¯åŒºåˆ†</label><select id="is_child" onchange="liveCalc()"><option value="0">é€šå¸¸ä¸–å¸¯</option><option value="1" selected>å­è‚²ã¦ãƒ»è‹¥å¤«å©¦</option></select></div>
            <div class="field"><label>ãƒ­ãƒ¼ãƒ³å½¢æ…‹</label><select id="is_pair" onchange="liveCalc()"><option value="1">å˜ç‹¬ãƒ­ãƒ¼ãƒ³</option><option value="2" selected>ãƒšã‚¢ãƒ­ãƒ¼ãƒ³</option></select></div>
        </div>
    </div>

    <div class="card">
        <div class="section-title">2. å„ãƒ—ãƒ©ãƒ³ã®æ¡ä»¶å…¥åŠ›</div>
        <div class="tabs" id="tabGroup">
            <button class="tab-btn active" data-type="rent" onclick="switchTab('rent', this)">è³ƒè²¸</button>
            <button class="tab-btn" data-type="nm" onclick="switchTab('nm', this)">æ–°ç¯‰ãƒãƒ³</button>
            <button class="tab-btn" data-type="om" onclick="switchTab('om', this)">ä¸­å¤ãƒãƒ³</button>
            <button class="tab-btn" data-type="nh" onclick="switchTab('nh', this)">æ–°ç¯‰æˆ¸å»º</button>
            <button class="tab-btn" data-type="oh" onclick="switchTab('oh', this)">ä¸­å¤æˆ¸å»º</button>
        </div>
        <div id="input-area" class="grid"></div>
        
        <div class="monthly-box">
            <div style="font-size:0.8rem; color:var(--secondary); margin-bottom:5px;">æœˆé¡ã‚³ã‚¹ãƒˆå†…è¨³ (æ¨ªç©ã¿ä¸Šã’)</div>
            <div style="height: 60px; margin-bottom: 10px;"><canvas id="miniChart"></canvas></div>
            <div class="monthly-total" id="live_monthly">-- ä¸‡å††</div>
            <div style="text-align:center; font-size:0.9rem; font-weight:bold; color:#ef4444; margin-top:5px;" id="initial_display">åˆæœŸè²»ç”¨ç›®å®‰: -- ä¸‡å††</div>
        </div>
        <button style="width:100%; padding:18px; background:#0f172a; color:white; border:none; border-radius:8px; cursor:pointer; font-size:1.1rem; font-weight:bold; margin-top:15px;" onclick="runSimulation()">å…¨ãƒ—ãƒ©ãƒ³ã‚’æ¯”è¼ƒè¨ˆç®—ã™ã‚‹</button>
    </div>

    <div id="resultArea" style="display:none;" class="card">
        <div class="section-title" style="display:flex; justify-content:space-between; align-items:center;">
            3. ç”Ÿæ¶¯ã‚³ã‚¹ãƒˆæ¨ç§»ã‚°ãƒ©ãƒ•
            <button class="info-btn" onclick="openModal('logic')">i</button>
        </div>
        
        <div class="chart-controls">
            <span>è¡¨ç¤ºè¨­å®š:</span>
            <label style="display:inline-flex; align-items:center; cursor:pointer;">
                <input type="checkbox" id="show_gross" checked onchange="runSimulation()"> <span style="margin-left:5px;">è² æ‹…é¡ç´¯è¨ˆ (å®Ÿç·š)</span>
            </label>
            <label style="display:inline-flex; align-items:center; cursor:pointer;">
                <input type="checkbox" id="show_net" checked onchange="runSimulation()"> <span style="margin-left:5px;">å®Ÿè³ªç·è² æ‹…é¡ (ç‚¹ç·š)</span>
            </label>
        </div>

        <div style="height: 400px; margin: 15px 0;"><canvas id="mainChart"></canvas></div>
        
        <div class="section-title">4. æ¯”è¼ƒè¡¨ã®ç®—å‡ºã‚¿ã‚¤ãƒŸãƒ³ã‚°</div>
        <div style="background:#fff7ed; padding:15px; border-radius:8px; border:1px solid #fb923c; margin-bottom:15px; display:flex; align-items:center; gap:15px;">
            <label style="margin:0; font-size:1rem;">å£²å´ãƒ»ä½ã¿æ›¿ãˆæƒ³å®šæ™‚æœŸ:</label>
            <select id="exit_year" class="exit-select" onchange="runSimulation()">
                <option value="5">5å¹´ç›®</option><option value="10">10å¹´ç›®</option><option value="15">15å¹´ç›®</option><option value="20">20å¹´ç›®</option>
                <option value="25">25å¹´ç›®</option><option value="30">30å¹´ç›®</option><option value="35" selected>35å¹´ç›®</option><option value="40">40å¹´ç›®</option><option value="50">50å¹´ç›®</option>
            </select>
            <span style="font-weight:bold; color:#9a3412;">æ™‚ç‚¹ã§ã®å†…è¨³è©³ç´°</span>
        </div>

        <div style="overflow-x:auto;">
            <table class="res-table" id="resTable">
                <thead>
                    <tr>
                        <th style="text-align:left">æ¯”è¼ƒãƒ—ãƒ©ãƒ³</th>
                        <th>ãƒ­ãƒ¼ãƒ³æ”¯æ‰•é¡<br>(å…ƒåˆ©åˆè¨ˆ)</th>
                        <th>åˆæœŸè²»ç”¨<br>(è«¸çµŒè²»/ãƒªãƒ•ã‚©)</th>
                        <th>ç¶­æŒè²»ç´¯è¨ˆ<br>(ä¿®ç¹•/ç®¡ç†/å›ºç¨)</th>
                        <th>æ§é™¤ç´¯è¨ˆ<br>(ç¨é‚„ä»˜)</th>
                        <th style="background:#fff7ed">æƒ³å®šå£²å´ä¾¡æ ¼<br>(æ®‹ä¾¡ä¸‹é™)</th>
                        <th style="background:#f0f9ff; color:#0f172a; font-size:0.75rem;">å®Ÿè³ªç·è² æ‹…é¡</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<div id="modal-logic" class="modal">
    <div class="modal-content">
        <h3>ğŸ“Š è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¨æ§é™¤åŒºåˆ†è¡¨</h3>
        <p><b>â–  ã‚°ãƒ©ãƒ•ã®ç·šã®é•ã„</b></p>
        <div style="background:#f1f5f9; padding:12px; border-radius:8px; font-size:0.8rem; line-height:1.6;">
            <b>å®Ÿç·šï¼ˆè² æ‹…é¡ç´¯è¨ˆï¼‰</b>: åˆæœŸè²»ç”¨ï¼‹ãƒ­ãƒ¼ãƒ³è¿”æ¸ˆï¼‹ç¶­æŒè²»ã®ã€Œåˆè¨ˆæ”¯å‡ºã€ã€‚<br>
            <b>ç‚¹ç·šï¼ˆå®Ÿè³ªç·è² æ‹…é¡ï¼‰</b>: æ”¯å‡ºã‹ã‚‰ã€Œå£²å´ä¾¡æ ¼ã€ã¨ã€Œãƒ­ãƒ¼ãƒ³æ§é™¤ã€ã‚’å¼•ã„ãŸã€ŒçœŸã®ã‚³ã‚¹ãƒˆã€ã€‚
        </div>
        <button class="close-btn" onclick="closeModal()">é–‰ã˜ã‚‹</button>
    </div>
</div>

<script>
    let activeTab = 'rent';
    let mainChart = null, miniChart = null;

    const store = {
        rent: { price: 18, taxType: 'none', depr: 0, minRes: 0 },
        nm: { price: 7000, maint: 1.0, shuzen: 1.0, rate_inc: 3.0, taxType: '3500', depr: 1.8, minRes: 50, kotei: 15 },
        om: { price: 6500, ref: 100, maint: 1.5, shuzen: 1.5, rate_inc: 3.0, taxType: '3000', depr: 1.2, minRes: 60, kotei: 12 },
        nh: { price: 6500, shuzen_total: 300, span: 15, taxType: '3500', depr: 3.5, minRes: 50, kotei: 12 },
        oh: { price: 6000, ref: 100, shuzen_total: 300, span: 15, taxType: '3000', depr: 2.0, minRes: 65, kotei: 10 }
    };

    const config = {
        rent: { label: 'è³ƒè²¸', color: '#16a34a' },
        nm: { label: 'æ–°ç¯‰ãƒãƒ³ã‚·ãƒ§ãƒ³', color: '#2563eb' },
        om: { label: 'ä¸­å¤ãƒãƒ³ã‚·ãƒ§ãƒ³', color: '#0ea5e9' },
        nh: { label: 'æ–°ç¯‰æˆ¸å»ºã¦', color: '#ea580c' },
        oh: { label: 'ä¸­å¤æˆ¸å»ºã¦', color: '#8b5cf6' }
    };

    function switch
